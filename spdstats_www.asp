<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="-1">
<link rel="shortcut icon" href="images/favicon.png">
<link rel="icon" href="images/favicon.png">
<title>spdMerlin</title>
<link rel="stylesheet" type="text/css" href="index_style.css">
<link rel="stylesheet" type="text/css" href="form_style.css">
<style>
p{font-weight:bolder;}thead.collapsible-jquery{color:white;padding:0;width:100%;border:none;text-align:left;outline:none;cursor:pointer;}td.nodata{font-size:48px!important;font-weight:bolder!important;height:65px!important;font-family:Arial!important;border:none!important;text-align:center!important;}.SettingsTable{text-align:left;}.SettingsTable input{text-align:left;margin-left:3px!important;}.SettingsTable input.savebutton{text-align:center;margin-top:5px;margin-bottom:5px;border-right:solid 1px black;border-left:solid 1px black;border-bottom:solid 1px black;}.SettingsTable td.savebutton{border-right:solid 1px black;border-left:solid 1px black;border-bottom:solid 1px black;background-color:rgb(77,89,93);}.SettingsTable .cronbutton{text-align:center;min-width:50px;width:50px;height:23px;vertical-align:middle;}.SettingsTable select{margin-left:3px!important;}.SettingsTable label{margin-right:10px!important;vertical-align:top!important;}.SettingsTable th{background-color:#1F2D35!important;background:#2F3A3E!important;border-bottom:none!important;border-top:none!important;font-size:12px!important;color:white!important;padding:4px!important;font-weight:bolder!important;padding:0!important;}.SettingsTable td{word-wrap:break-word!important;overflow-wrap:break-word!important;border-right:none;border-left:none;}.SettingsTable span.settingname{background-color:#1F2D35!important;background:#2F3A3E!important;}.SettingsTable td.settingname{border-right:solid 1px black;border-left:solid 1px black;background-color:#1F2D35!important;background:#2F3A3E!important;width:34%!important;}.SettingsTable td.settingvalue{text-align:left!important;border-right:solid 1px black;}.SettingsTable th:first-child{border-left:none!important;}.SettingsTable th:last-child{border-right:none!important;}.SettingsTable .invalid{background-color:darkred!important;}.SettingsTable .disabled{background-color:#CCCCCC!important;color:#888888!important;}div.sortTableContainer{height:300px;overflow-y:scroll;width:745px;border:1px solid #000;}.sortTable{table-layout:fixed!important;border:none;}thead.sortTableHeader th{background-image:linear-gradient(rgb(146,160,165) 0%,rgb(102,117,124) 100%);border-top:none!important;border-left:none!important;border-right:none!important;border-bottom:1px solid #000!important;font-weight:bolder;padding:2px;text-align:center;color:#fff;position:sticky;top:0;font-size:11px!important;}thead.sortTableHeader th:first-child,thead.sortTableHeader th:last-child{border-right:none!important;}thead.sortTableHeader th:last-child{}thead.sortTableHeader th:first-child,thead.sortTableHeader td:first-child{border-left:none!important;}tbody.sortTableContent td:last-child,tbody.sortTableContent tr.sortNormalRow td:last-child,tbody.sortTableContent tr.sortAlternateRow td:last-child{}tbody.sortTableContent td{border-bottom:1px solid #000!important;border-left:none!important;border-right:1px solid #000!important;border-top:none!important;padding:2px;text-align:center;overflow:hidden!important;white-space:nowrap!important;font-size:12px!important;}tbody.sortTableContent tr.sortRow:nth-child(odd) td{background-color:#2F3A3E!important;}tbody.sortTableContent tr.sortRow:nth-child(even) td{background-color:#475A5F!important;}th.sortable{cursor:pointer;}tbody.sortTableContent td a{text-decoration:underline!important;}.removespacing{padding-left:0!important;margin-left:0!important;margin-bottom:5px!important;text-align:center!important;}.schedulespan{display:inline-block!important;width:70px!important;color:#FFFFFF!important;font-weight:bold!important;}div.schedulesettings{margin-bottom:5px;}.spdtest_output{border:solid 1px black;}textarea.settings{font-family:'Courier New',Courier,mono!important;font-size:11px!important;padding:2px!important;background:#576D73!important;width:98%!important;}
</style>
<script language="JavaScript" type="text/javascript" src="/js/jquery.js"></script>
<script language="JavaScript" type="text/javascript" src="/js/httpApi.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/moment.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/chart.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/hammerjs.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/chartjs-plugin-zoom.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/chartjs-plugin-annotation.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/d3.js"></script>
<script language="JavaScript" type="text/javascript" src="/state.js"></script>
<script language="JavaScript" type="text/javascript" src="/general.js"></script>
<script language="JavaScript" type="text/javascript" src="/popup.js"></script>
<script language="JavaScript" type="text/javascript" src="/help.js"></script>
<script language="JavaScript" type="text/javascript" src="/ext/shared-jy/detect.js"></script>
<script language="JavaScript" type="text/javascript" src="/tmhist.js"></script>
<script language="JavaScript" type="text/javascript" src="/tmmenu.js"></script>
<script language="JavaScript" type="text/javascript" src="/client_function.js"></script>
<script language="JavaScript" type="text/javascript" src="/validator.js"></script>
<script>

/**----------------------------------------**/
/** Modified by Martinski W. [2025-Oct-14] **/
/**----------------------------------------**/

var custom_settings;
function LoadCustomSettings()
{
	custom_settings = <% get_custom_settings(); %>;
	for (var prop in custom_settings)
	{
		if (Object.prototype.hasOwnProperty.call(custom_settings,prop))
		{
			if (prop.indexOf('spdmerlin') !== -1 && prop.indexOf('spdmerlin_version') === -1)
			{ eval('delete custom_settings.' + prop); }
		}
	}
}

var daysofweek=["Mon","Tues","Wed","Thurs","Fri","Sat","Sun"],maxNoCharts=0,currentNoCharts=0;let interfaceList="",interfacesComplete=[],interfacesDisabled=[];var arraysortlistlinesWAN=[],sortnameWAN="Time",sortdirWAN="desc",arraysortlistlinesVPNC1=[],sortnameVPNC1="Time",sortdirVPNC1="desc",arraysortlistlinesVPNC2=[],sortnameVPNC2="Time",sortdirVPNC2="desc",arraysortlistlinesVPNC3=[],sortnameVPNC3="Time",sortdirVPNC3="desc",arraysortlistlinesVPNC4=[],sortnameVPNC4="Time",sortdirVPNC4="desc",arraysortlistlinesVPNC5=[],sortnameVPNC5="Time",sortdirVPNC5="desc",arraysortlistlinesWGVPN1=[],sortnameWGVPN1="Time",sortdirWGVPN1="desc",arraysortlistlinesWGVPN2=[],sortnameWGVPN2="Time",sortdirWGVPN2="desc",arraysortlistlinesWGVPN3=[],sortnameWGVPN3="Time",sortdirWGVPN3="desc",arraysortlistlinesWGVPN4=[],sortnameWGVPN4="Time",sortdirWGVPN4="desc",arraysortlistlinesWGVPN5=[],sortnameWGVPN5="Time",sortdirWGVPN5="desc",speedtestbinary="builtin";let databaseResetDone=0;var sqlDatabaseFileSize="0 Bytes",jffsAvailableSpaceStr="0 Bytes",jffsAvailableSpaceLow="OK",ShowLines=GetCookie("ShowLines","string"),ShowFill=GetCookie("ShowFill","string");""==ShowFill&&(ShowFill="origin");var DragZoom=!0,ChartPan=!1;Chart.defaults.global.defaultFontColor="#CCC",Chart.Tooltip.positioners.cursor=function(e,t){return t};var dataintervallist=["raw","hour","day"],chartlist=["daily","weekly","monthly"],timeunitlist=["hour","day","day"],intervallist=[24,7,30],bordercolourlist_Combined=["#fc8500","#42ecf5"],backgroundcolourlist_Combined=["rgba(252,133,0,0.5)","rgba(66,236,245,0.5)"],bordercolourlist_Quality=["#53047a","#07f242","#ffffff"],backgroundcolourlist_Quality=["rgba(83,4,122,0.5)","rgba(7,242,66,0.5)","rgba(255,255,255,0.5)"],typelist=["Combined","Quality"],myinterval;function keyHandler(e){82==e.keyCode?($(document).off("keydown"),ResetZoom()):68==e.keyCode?($(document).off("keydown"),ToggleDragZoom(document.form.btnDragZoom)):70==e.keyCode?($(document).off("keydown"),ToggleFill()):76==e.keyCode&&($(document).off("keydown"),ToggleLines())}function Draw_Chart_NoData(e,t,a){document.getElementById("divLineChart_"+e+"_"+t).width="730",document.getElementById("divLineChart_"+e+"_"+t).height="500",document.getElementById("divLineChart_"+e+"_"+t).style.width="730px",document.getElementById("divLineChart_"+e+"_"+t).style.height="500px";var s=document.getElementById("divLineChart_"+e+"_"+t).getContext("2d");s.save(),s.textAlign="center",s.textBaseline="middle",s.font="normal normal bolder 48px Arial",s.fillStyle="white",s.fillText(a,365,250),s.restore()}function Draw_Chart(e,t){var a="",s="",r="",i="",n="",l="",o=!1;"Combined"==t?(a="Mbps",r="Bandwidth",i="Download",n="Upload"):"Quality"==t&&(a="ms",s="%",r="Quality",i="Latency",n="Jitter",l="PktLoss",o=!0);var d=getChartPeriod($("#"+e+"_Period_"+t+" option:selected").val()),c=getChartInterval($("#"+e+"_Interval_"+t+" option:selected").val()),p=timeunitlist[$("#"+e+"_Period_"+t+" option:selected").val()],m=intervallist[$("#"+e+"_Period_"+t+" option:selected").val()],u=moment(),f=null,h=moment().subtract(m,p+"s"),b="line",_=window[t+"_"+c+"_"+d+"_"+e];if(null!=_)if(0!=_.length){_.map((function(e){return{x:e.Time,y:e.Value}}));var v=[],g=[];for(let e=0;e<_.length;e++)v[_[e].Metric]||(g.push(_[e].Metric),v[_[e].Metric]=1);var y=_.filter((function(e){return e.Metric==i})).map((function(e){return{x:e.Time,y:e.Value}})),w=_.filter((function(e){return e.Metric==n})).map((function(e){return{x:e.Time,y:e.Value}})),x=_.filter((function(e){return e.Metric==l})).map((function(e){return{x:e.Time,y:e.Value}})),C=window["LineChart_"+e+"_"+t],S=getTimeFormat($("#Time_Format option:selected").val(),"axis"),T=getTimeFormat($("#Time_Format option:selected").val(),"tooltip");"day"==c&&(b="bar",f=moment().endOf("day").subtract(9,"hours"),h=moment().startOf("day").subtract(m-1,p+"s").subtract(12,"hours"),u=f),"daily"==d&&"day"==c&&(p="day",m=1,f=moment().endOf("day").subtract(9,"hours"),h=moment().startOf("day").subtract(12,"hours"),u=f),factor=0,"hour"==p?factor=36e5:"day"==p&&(factor=864e5),null!=C&&C.destroy();var L=document.getElementById("divLineChart_"+e+"_"+t).getContext("2d"),k={segmentShowStroke:!1,segmentStrokeColor:"#000",animationEasing:"easeOutQuart",animationSteps:100,maintainAspectRatio:!1,animateScale:!0,hover:{mode:"point"},legend:{display:!0,position:"top",reverse:!0,onClick:function(e,t){var a=t.datasetIndex,s=this.chart,r=s.getDatasetMeta(a);if(r.hidden=null===r.hidden?!s.data.datasets[a].hidden:null,"line"==ShowLines){var i="";if(1!=r.hidden&&(i="line"),"Latency"==s.data.datasets[a].label||"Download"==s.data.datasets[a].label)for(aindex=0;aindex<3;aindex++)s.options.annotation.annotations[aindex].type=i;else if("Jitter"==s.data.datasets[a].label||"Upload"==s.data.datasets[a].label)for(aindex=3;aindex<6;aindex++)s.options.annotation.annotations[aindex].type=i;else if("Packet Loss"==s.data.datasets[a].label)for(aindex=6;aindex<9;aindex++)s.options.annotation.annotations[aindex].type=i}if("Packet Loss"==s.data.datasets[a].label){var n=!1;1!=r.hidden&&(n=!0),s.scales["right-y-axis"].options.display=n}s.update()}},title:{display:!0,text:r},tooltips:{callbacks:{title:function(e,t){return"day"==c?moment(e[0].xLabel,"X").format("YYYY-MM-DD"):moment(e[0].xLabel,"X").format(T)},label:function(e,t){var r=a;return"Packet Loss"==t.datasets[e.datasetIndex].label&&(r=s),round(t.datasets[e.datasetIndex].data[e.index].y,2).toFixed(2)+" "+r}},itemSort:function(e,t){return t.datasetIndex-e.datasetIndex},mode:"point",position:"cursor",intersect:!0},scales:{xAxes:[{type:"time",gridLines:{display:!0,color:"#282828"},ticks:{min:h,max:f,display:!0},time:{parser:"X",unit:p,stepSize:1,displayFormats:S}}],yAxes:[{type:getChartScale($("#"+e+"_Scale_"+t+" option:selected").val()),gridLines:{display:!1,color:"#282828"},scaleLabel:{display:!1,labelString:a},id:"left-y-axis",position:"left",ticks:{display:!0,beginAtZero:!0,labels:{index:["min","max"],removeEmptyLines:!0},userCallback:LogarithmicFormatter}},{type:getChartScale($("#"+e+"_Scale_"+t+" option:selected").val()),gridLines:{display:!1,color:"#282828"},scaleLabel:{display:!1,labelString:s},id:"right-y-axis",position:"right",ticks:{display:o,beginAtZero:!0,labels:{index:["min","max"],removeEmptyLines:!0},userCallback:LogarithmicFormatter}}]},plugins:{zoom:{pan:{enabled:ChartPan,mode:"xy",rangeMin:{x:h,y:0},rangeMax:{x:u}},zoom:{enabled:!0,drag:DragZoom,mode:"xy",rangeMin:{x:h,y:0},rangeMax:{x:u},speed:.1}}},annotation:{drawTime:"afterDatasetsDraw",annotations:[{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getAverage(y),borderColor:window["bordercolourlist_"+t][0],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"center",enabled:!0,xAdjust:0,yAdjust:0,content:"Avg. "+i+"="+round(getAverage(y),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getLimit(y,"y","max",!0),borderColor:window["bordercolourlist_"+t][0],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"right",enabled:!0,xAdjust:15,yAdjust:0,content:"Max. "+i+"="+round(getLimit(y,"y","max",!0),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getLimit(y,"y","min",!0),borderColor:window["bordercolourlist_"+t][0],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"left",enabled:!0,xAdjust:15,yAdjust:0,content:"Min. "+i+"="+round(getLimit(y,"y","min",!0),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getAverage(w),borderColor:window["bordercolourlist_"+t][1],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"center",enabled:!0,xAdjust:0,yAdjust:0,content:"Avg. "+n+"="+round(getAverage(w),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getLimit(w,"y","max",!0),borderColor:window["bordercolourlist_"+t][1],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"right",enabled:!0,xAdjust:15,yAdjust:0,content:"Max. "+n+"="+round(getLimit(w,"y","max",!0),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"left-y-axis",value:getLimit(w,"y","min",!0),borderColor:window["bordercolourlist_"+t][1],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"left",enabled:!0,xAdjust:15,yAdjust:0,content:"Min. "+n+"="+round(getLimit(w,"y","min",!0),2).toFixed(2)+a}},{type:ShowLines,mode:"horizontal",scaleID:"right-y-axis",value:getAverage(x),borderColor:window["bordercolourlist_"+t][2],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"center",enabled:!0,xAdjust:0,yAdjust:0,content:"Avg. "+l+"="+round(getAverage(x),2).toFixed(2)+s}},{type:ShowLines,mode:"horizontal",scaleID:"right-y-axis",value:getLimit(x,"y","max",!0),borderColor:window["bordercolourlist_"+t][2],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"right",enabled:!0,xAdjust:15,yAdjust:0,content:"Max. "+l+"="+round(getLimit(x,"y","max",!0),2).toFixed(2)+s}},{type:ShowLines,mode:"horizontal",scaleID:"right-y-axis",value:getLimit(x,"y","min",!0),borderColor:window["bordercolourlist_"+t][2],borderWidth:1,borderDash:[5,5],label:{backgroundColor:"rgba(0,0,0,0.3)",fontFamily:"sans-serif",fontSize:10,fontStyle:"bold",fontColor:"#fff",xPadding:6,yPadding:6,cornerRadius:6,position:"left",enabled:!0,xAdjust:15,yAdjust:0,content:"Min. "+l+"="+round(getLimit(x,"y","min",!0),2).toFixed(2)+s}}]}},D={datasets:getDataSets(t,_,g)};C=new Chart(L,{type:b,options:k,data:D}),window["LineChart_"+e+"_"+t]=C}else Draw_Chart_NoData(e,t,"No data to display");else Draw_Chart_NoData(e,t,"No data to display")}function LogarithmicFormatter(e,t,a){var s=this.options.scaleLabel.labelString;if("logarithmic"!=this.type)return isNaN(e)?e+" "+s:round(e,2).toFixed(2)+" "+s;var r=this.options.ticks.labels||{},i=r.index||["min","max"],n=r.significand||[1,2,5],l=e/Math.pow(10,Math.floor(Chart.helpers.log10(e))),o=!0===r.removeEmptyLines?void 0:"",d="";return 0===t?d="min":t===a.length-1&&(d="max"),"all"===r||-1!==n.indexOf(l)||-1!==i.indexOf(t)||-1!==i.indexOf(d)?0===e?"0 "+s:isNaN(e)?e+" "+s:round(e,2).toFixed(2)+" "+s:o}function getDataSets(e,t,a){var s=[];colourname="#fc8500";for(var r=0;r<a.length;r++){var i=t.filter((function(e){return e.Metric==a[r]})).map((function(e){return{x:e.Time,y:e.Value}})),n="left-y-axis";"PktLoss"==a[r]&&(n="right-y-axis"),s.push({label:a[r].replace("PktLoss","Packet Loss"),data:i,yAxisID:n,borderWidth:1,pointRadius:1,lineTension:0,fill:ShowFill,backgroundColor:window["backgroundcolourlist_"+e][r],borderColor:window["bordercolourlist_"+e][r]})}return s.reverse(),s}function getLimit(e,t,a,s){var r,i=0;return r="x"==t?e.map((function(e){return e.x})):e.map((function(e){return e.y})),i="max"==a?Math.max.apply(Math,r):Math.min.apply(Math,r),"max"==a&&0==i&&0==s&&(i=1),i}function getAverage(e){for(var t=0,a=0;a<e.length;a++)t+=1*e[a].y;return t/e.length}function round(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}function ToggleLines(){var e=interfaceList.split(",");""==ShowLines?(ShowLines="line",SetCookie("ShowLines","line")):(ShowLines="",SetCookie("ShowLines",""));for(var t=0;t<e.length;t++)for(var a=0;a<typelist.length;a++){var s=window["LineChart_"+e[t]+"_"+typelist[a]];if(null!=s){var r=6;"Quality"==typelist[a]&&(r=9);for(var i=0;i<r;i++)s.options.annotation.annotations[i].type=ShowLines;s.update()}}}function ToggleFill(){var e=interfaceList.split(",");"origin"==ShowFill?(ShowFill="false",SetCookie("ShowFill","false")):(ShowFill="origin",SetCookie("ShowFill","origin"));for(var t=0;t<e.length;t++)for(var a=0;a<typelist.length;a++){var s=window["LineChart_"+e[t]+"_"+typelist[a]];null!=s&&(s.data.datasets[0].fill=ShowFill,s.data.datasets[1].fill=ShowFill,"Quality"==typelist[a]&&(s.data.datasets[2].fill=ShowFill),s.update())}}function RedrawAllCharts(){for(var e=interfaceList.split(","),t=0;t<chartlist.length;t++)for(var a=0;a<e.length;a++){Draw_Chart_NoData(e[a],"Combined","Data loading..."),Draw_Chart_NoData(e[a],"Quality","Data loading...");for(var s=0;s<dataintervallist.length;s++)d3.csv("/ext/spdmerlin/csv/Combined_"+dataintervallist[s]+"_"+chartlist[t]+"_"+e[a]+".htm").then(SetGlobalDataset.bind(null,"Combined_"+dataintervallist[s]+"_"+chartlist[t]+"_"+e[a])),d3.csv("/ext/spdmerlin/csv/Quality_"+dataintervallist[s]+"_"+chartlist[t]+"_"+e[a]+".htm").then(SetGlobalDataset.bind(null,"Quality_"+dataintervallist[s]+"_"+chartlist[t]+"_"+e[a]))}}function SetGlobalDataset(e,t){if(window[e]=t,++currentNoCharts==maxNoCharts)for(var a=interfaceList.split(","),s=0;s<a.length;s++)$("#"+a[s]+"_Interval_Combined").val(GetCookie(a[s]+"_Interval_Combined","number")),$("#"+a[s]+"_Interval_Quality").val(GetCookie(a[s]+"_Interval_Quality","number")),changePeriod(document.getElementById(a[s]+"_Interval_Combined")),changePeriod(document.getElementById(a[s]+"_Interval_Quality")),$("#"+a[s]+"_Period_Combined").val(GetCookie(a[s]+"_Period_Combined","number")),$("#"+a[s]+"_Period_Quality").val(GetCookie(a[s]+"_Period_Quality","number")),$("#"+a[s]+"_Scale_Combined").val(GetCookie(a[s]+"_Scale_Combined","number")),$("#"+a[s]+"_Scale_Quality").val(GetCookie(a[s]+"_Scale_Quality","number")),Draw_Chart(a[s],"Combined"),Draw_Chart(a[s],"Quality")}function getTimeFormat(e,t){var a;return"axis"==t?0==e?a={millisecond:"HH:mm:ss.SSS",second:"HH:mm:ss",minute:"HH:mm",hour:"HH:mm"}:1==e&&(a={millisecond:"h:mm:ss.SSS A",second:"h:mm:ss A",minute:"h:mm A",hour:"h A"}):"tooltip"==t&&(0==e?a="YYYY-MM-DD HH:mm:ss":1==e&&(a="YYYY-MM-DD h:mm:ss A")),a}function GetCookie(e,t){return null!=cookie.get("spd_"+e)?cookie.get("spd_"+e):"string"==t?"":"number"==t?0:void 0}function SetCookie(e,t){cookie.set("spd_"+e,t,3650)}function SetCurrentPage(){document.form.next_page.value=window.location.pathname.substring(1),document.form.current_page.value=window.location.pathname.substring(1)}function initial(){SetCurrentPage(),LoadCustomSettings(),show_menu(),$("#Time_Format").val(GetCookie("Time_Format","number")),scriptUpdateLayout(),getStatsTitleFile(),getInterfacesFile(),showhide("databaseSize_text",!0),showhide("jffsFreeSpace_text",!0),showhide("jffsFreeSpace_LOW",!1),showhide("jffsFreeSpace_WARN",!1),showhide("jffsFreeSpace_NOTE",!1)}function scriptUpdateLayout(){var e=GetVersionNumber("local"),t=GetVersionNumber("server");$("#spdmerlin_version_local").text(e),e!=t&&"N/A"!=t&&($("#spdmerlin_version_server").text("Updated version available: "+t),showhide("btnChkUpdate",!1),showhide("spdmerlin_version_server",!0),showhide("btnDoUpdate",!0))}function reload(){location.reload(!0)}function getYAxisMax(e){if(-1!=e.indexOf("Quality"))return 100}function getChartInterval(e){var t="raw";return 0==e?t="raw":1==e?t="hour":2==e&&(t="day"),t}function changePeriod(e){var t=1*e.value,a=e.id.substring(0,e.id.indexOf("_")),s=e.id.substring(e.id.lastIndexOf("_")+1);2==t?$('select[id="'+a+"_Period_"+s+'"] option:contains(24)').text("Today"):$('select[id="'+a+"_Period_"+s+'"] option:contains("Today")').text("Last 24 hours")}function getChartPeriod(e){var t="daily";return 0==e?t="daily":1==e?t="weekly":2==e&&(t="monthly"),t}function getChartScale(e){var t="";return 0==e?t="linear":1==e&&(t="logarithmic"),t}function ResetZoom(){for(var e=interfaceList.split(","),t=0;t<e.length;t++)for(var a=0;a<typelist.length;a++){var s=window["LineChart_"+e[t]+"_"+typelist[a]];null!=s&&s.resetZoom()}}function ToggleDragZoom(e){var t=!0,a=!1,s="";-1!=e.value.indexOf("On")?(t=!1,a=!0,DragZoom=!1,ChartPan=!0,s="Drag Zoom Off"):(t=!0,a=!1,DragZoom=!0,ChartPan=!1,s="Drag Zoom On");for(var r=interfaceList.split(","),i=0;i<r.length;i++){for(var n=0;n<typelist.length;n++){var l=window["LineChart_"+r[i]+"_"+typelist[n]];null!=l&&(l.options.plugins.zoom.zoom.drag=t,l.options.plugins.zoom.pan.enabled=a,l.update())}e.value=s}}function ExportCSV(){return location.href="/ext/spdmerlin/csv/spdmerlindata.zip",0}function update_status(){$.ajax({url:"/ext/spdmerlin/detect_update.js",dataType:"script",error:function(e){setTimeout(update_status,1e3)},success:function(){"InProgress"==updatestatus?setTimeout(update_status,1e3):(document.getElementById("imgChkUpdate").style.display="none",showhide("spdmerlin_version_server",!0),"None"!=updatestatus?($("#spdmerlin_version_server").text("Updated version available: "+updatestatus),showhide("btnChkUpdate",!1),showhide("btnDoUpdate",!0)):($("#spdmerlin_version_server").text("No update available"),showhide("btnChkUpdate",!0),showhide("btnDoUpdate",!1)))}})}function CheckUpdate(){showhide("btnChkUpdate",!1),document.formScriptActions.action_script.value="start_spdmerlincheckupdate",document.formScriptActions.submit(),document.getElementById("imgChkUpdate").style.display="",setTimeout(update_status,2e3)}function DoUpdate(){document.form.action_script.value="start_spdmerlindoupdate",document.form.action_wait.value=10,showLoading(),document.form.submit()}function getAllIndexes(e,t){for(var a=[],s=0;s<e.length;s++)e[s].id==t&&a.push(s);return a}function get_spdtestservers_file(e){$.ajax({url:"/ext/spdmerlin/spdmerlin_serverlist_"+e.toUpperCase()+".htm?cachebuster="+(new Date).getTime(),dataType:"text",error:function(t){setTimeout(get_spdtestservers_file,1e3,e)},success:function(t){var a=[];$.each(t.split("\n").filter(Boolean),(function(e,t){var s={};s.id=t.split("|")[0],s.name=t.split("|")[1],a.push(s)})),$("#spdmerlin_preferredserver_"+e).prop("disabled",!1),$("#spdmerlin_preferredserver_"+e).removeClass("disabled");let s=$("#spdmerlin_preferredserver_"+e);s.empty(),$.each(a,(function(e,t){s.append($("<option></option>").attr("value",t.id+"|"+t.name).text(t.id+"|"+t.name))})),s.prop("selectedIndex",0),$("#spdmerlin_preferredserver_"+e)[0].style.display="",showhide("imgServerList_"+e,!1)}})}function get_manualspdtestservers_file(){$.ajax({url:"/ext/spdmerlin/spdmerlin_manual_serverlist.htm?cachebuster="+(new Date).getTime(),dataType:"text",error:function(e){setTimeout(get_manualspdtestservers_file,2e3)},success:function(e){var t=[];if($.each(e.split("\n").filter(Boolean),(function(e,a){var s={};s.id=a.split("|")[0],s.name=a.split("|")[1],t.push(s)})),"All"==document.form.spdtest_enabled.value){for(var a=getAllIndexes(t,"-----"),s=0;s<a.length;s++){let e=$($("select[name^=spdtest_serverprefselect]")[s]);e.empty();var r=[];r=0==s?t.slice(0,a[s]):s==a.length-1?t.slice(a[s-1]+1,t.length-1):t.slice(a[s-1]+1,a[s]),$.each(r,(function(t,a){e.append($("<option></option>").attr("value",a.id+"|"+a.name).text(a.id+"|"+a.name))})),e.prop("selectedIndex",0)}$.each($("select[name^=spdtest_serverprefselect]"),(function(){this.style.display="inline-block"})),$.each($("span[id^=spdtest_serverprefselectspan]"),(function(){this.style.display="inline-block"})),showhide("imgManualServerList",!1)}else{let e=$("select[name=spdtest_serverprefselect]");e.empty(),$.each(t,(function(t,a){e.append($("<option></option>").attr("value",a.id+"|"+a.name).text(a.id+"|"+a.name))})),e.prop("selectedIndex",0),showhide("spdtest_serverprefselect",!0),showhide("imgManualServerList",!1)}for(s=0;s<interfacesComplete.length;s++)0==interfacesDisabled.includes(interfacesComplete[s])&&($("#spdtest_enabled_"+interfacesComplete[s].toLowerCase()).prop("disabled",!1),$("#spdtest_enabled_"+interfacesComplete[s].toLowerCase()).removeClass("disabled"));$.each($("input[name=spdtest_serverpref]"),(function(){$(this).prop("disabled",!1),$(this).removeClass("disabled")}))}})}function get_spdtestresult_file(){$.ajax({url:"/ext/spdmerlin/spd-result.htm",dataType:"text",error:function(e){setTimeout(get_spdtestresult_file,1e3)},success:function(e){var t=e.trim().split("\n");e=t.join("\n"),$("#spdtest_output").html(e),PostSpeedTest()}})}function get_spdtest_file(){$.ajax({url:"/ext/spdmerlin/spd-stats.htm",dataType:"text",error:function(e){},success:function(e){var t=e.trim().split("\n"),a=t.slice(-1)[0].split("%").filter(Boolean);"builtin"==speedtestbinary&&(t.unshift(""),t.unshift("Speedtest by Ookla")),t.length>5?$("#spdtest_output").html(t[0]+"\n"+t[1]+"\n"+t[2]+"\n"+t[3]+"\n"+t[4]+"\n"+a[a.length-1]+"%"):$("#spdtest_output").html("")}})}function update_spdtest(){$.ajax({url:"/ext/spdmerlin/detect_spdtest.js",dataType:"script",error:function(e){},success:function(){-1!=spdteststatus.indexOf("InProgress")?-1!=spdteststatus.indexOf("_")&&(showhide("imgSpdTest",!0),showhide("spdtest_text",!0),document.getElementById("spdtest_text").innerHTML="Speedtest in progress for "+spdteststatus.substring(spdteststatus.indexOf("_")+1),document.getElementById("spdtest_output").parentElement.parentElement.style.display="",get_spdtest_file()):"GenerateCSV"==spdteststatus?document.getElementById("spdtest_text").innerHTML="Retrieving data for charts...":"Done"==spdteststatus?(clearInterval(myinterval),0==intervalclear&&(intervalclear=!0,document.getElementById("spdtest_text").innerHTML="Refreshing tables and charts...",get_spdtestresult_file())):"LOCKED"==spdteststatus?(clearInterval(myinterval),showhide("imgSpdTest",!1),document.getElementById("spdtest_text").innerHTML="Scheduled speedtest already running!",showhide("spdtest_text",!0),document.getElementById("spdtest_output").parentElement.parentElement.style.display="none",showhide("btnRunSpeedtest",!0)):"NoLicense"==spdteststatus?(clearInterval(myinterval),showhide("imgSpdTest",!1),document.getElementById("spdtest_text").innerHTML="Please accept Ookla license at command line via spdmerlin",showhide("spdtest_text",!0),document.getElementById("spdtest_output").parentElement.parentElement.style.display="none",showhide("btnRunSpeedtest",!0)):"Error"==spdteststatus?(clearInterval(myinterval),showhide("imgSpdTest",!1),document.getElementById("spdtest_text").innerHTML="Error running speedtest",showhide("spdtest_text",!0),document.getElementById("spdtest_output").parentElement.parentElement.style.display="none",showhide("btnRunSpeedtest",!0)):"NoSwap"==spdteststatus&&(clearInterval(myinterval),showhide("imgSpdTest",!1),document.getElementById("spdtest_text").innerHTML="No Swap file configured/detected",showhide("spdtest_text",!0),document.getElementById("spdtest_output").parentElement.parentElement.style.display="none",showhide("btnRunSpeedtest",!0))}})}function ClearSpdTableRows(){$("#table_allinterfaces").empty(),$("#rowautomaticspdtest").empty(),$("#rowautospdprefserver").empty(),$("#rowautospdprefserverselect").empty(),$("#rowmanualspdtest").empty(),$("#table_allinterfaces").remove(),$("#rowautomaticspdtest").remove(),$("#rowautospdprefserver").remove(),$("#rowautospdprefserverselect").remove(),$("#rowmanualspdtest").remove()}function PostSpeedTest(){ClearSpdTableRows(),currentNoCharts=0,$("#Time_Format").val(GetCookie("Time_Format","number")),getStatsTitleFile(),setTimeout(getInterfacesFile,3e3)}function RunSpeedtest(){showhide("btnRunSpeedtest",!1),showhide("databaseSize_text",!1),$("#spdtest_output").html("");var e="";let t;"onetime"==document.form.spdtest_serverpref.value&&("All"==document.form.spdtest_enabled.value?($.each($("select[name^=spdtest_serverprefselect]"),(function(){e+=this.value.substring(0,this.value.indexOf("|"))+"-"})),e=e.slice(0,-1)):e=document.form.spdtest_serverprefselect.value.substring(0,document.form.spdtest_serverprefselect.value.indexOf("|"))),t="start_spdmerlinspdtest_"+document.form.spdtest_serverpref.value+"_"+document.form.spdtest_enabled.value+"_"+e.replace(/ /g,"%"),document.formScriptActions.action_script.value=t,document.formScriptActions.submit(),showhide("imgSpdTest",!0),showhide("spdtest_text",!1),setTimeout(StartSpeedTestInterval,5e3)}$(document).keydown((function(e){keyHandler(e)})),$(document).keyup((function(e){$(document).keydown((function(e){keyHandler(e)}))})),$.fn.serializeObject=function(){var e=custom_settings,t=this.serializeArray();$.each(t,(function(){void 0!==e[this.name]&&-1!=this.name.indexOf("spdmerlin")&&-1==this.name.indexOf("version")&&-1==this.name.indexOf("spdmerlin_iface_enabled")&&-1==this.name.indexOf("spdmerlin_usepreferred")&&-1==this.name.indexOf("schdays")&&-1==this.name.indexOf("spdmerlin_preferredserver")?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):-1!=this.name.indexOf("spdmerlin")&&-1==this.name.indexOf("version")&&-1==this.name.indexOf("spdmerlin_iface_enabled")&&-1==this.name.indexOf("spdmerlin_usepreferred")&&-1==this.name.indexOf("schdays")&&-1==this.name.indexOf("spdmerlin_preferredserver")&&(e[this.name]=this.value||"")})),$.each(t,(function(){void 0!==e[this.name]&&-1!=this.name.indexOf("spdmerlin_preferredserver")?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):-1!=this.name.indexOf("spdmerlin_preferredserver")&&(e[this.name]=this.value||"")}));var a=[];$.each($('input[name="spdmerlin_schdays"]:checked'),(function(){a.push($(this).val())}));var s=a.join(",");"Mon,Tues,Wed,Thurs,Fri,Sat,Sun"==s&&(s="*"),e.spdmerlin_schdays=s,$.each($('input[name^="spdmerlin_usepreferred"]'),(function(){e[this.id]=this.checked.toString()}));var r=[];$.each($('input[name="spdmerlin_iface_enabled"]:checked'),(function(){r.push(this.value)}));var i=r.join(",");return e.spdmerlin_ifaces_enabled=i,e};var intervalclear=!1;function StartSpeedTestInterval(){intervalclear=!1,myinterval=setInterval(update_spdtest,1e3)}function SaveConfig(){if(!validateAll())return!1;$("[name*=spdmerlin_]").prop("disabled",!1);for(var e=0;e<interfacesComplete.length;e++)$("#spdmerlin_iface_enabled_"+interfacesComplete[e].toLowerCase()).prop("disabled",!1),$("#spdmerlin_iface_enabled_"+interfacesComplete[e].toLowerCase()).removeClass("disabled"),$("#spdmerlin_usepreferred_"+interfacesComplete[e].toLowerCase()).prop("disabled",!1),$("#spdmerlin_usepreferred_"+interfacesComplete[e].toLowerCase()).removeClass("disabled"),$("#changepref_"+interfacesComplete[e].toLowerCase()).prop("disabled",!1),$("#changepref_"+interfacesComplete[e].toLowerCase()).removeClass("disabled");if("true"===document.form.spdmerlin_automaticmode.value){if("EveryX"===document.form.schedulemode.value)if("hours"===document.form.everyxselect.value){var t=1*document.form.everyxvalue.value;document.form.spdmerlin_schmins.value=0,document.form.spdmerlin_schhours.value=24==t?0:"*/"+t}else if("minutes"===document.form.everyxselect.value){document.form.spdmerlin_schhours.value="*";t=1*document.form.everyxvalue.value;document.form.spdmerlin_schmins.value="*/"+t}}else AutomaticInterfaceEnableDisable($("#spdmerlin_auto_"+document.form.spdmerlin_automaticmode.value)[0]);document.getElementById("amng_custom").value=JSON.stringify($("form").serializeObject()),document.form.action_script.value="start_spdmerlinconfig",document.form.action_wait.value=10,showLoading(),document.form.submit()}function GetVersionNumber(e){var t;return"local"==e?t=custom_settings.spdmerlin_version_local:"server"==e&&(t=custom_settings.spdmerlin_version_server),void 0===t||null==t?"N/A":t}function get_autobw_file(){$.ajax({url:"/ext/spdmerlin/autobwoutfile.htm",dataType:"text",error:function(e){},success:function(e){document.getElementById("AutoBWOutput").innerHTML=e}})}function getConfigFile(){$.ajax({url:"/ext/spdmerlin/config.htm",dataType:"text",error:function(e){setTimeout(getConfigFile,1e3)},success:function(data){let settingname,settingvalue;var configdata=data.split("\n");configdata=configdata.filter(Boolean);for(var indx=0;indx<configdata.length;indx++)if(0!==configdata[indx].length&&null===configdata[indx].match("^[ ]*#")&&(settingname=configdata[indx].split("=")[0],settingvalue=configdata[indx].split("=")[1].replace(/(\r\n|\n|\r)/gm,""),null===settingname.match(/^(JFFS_MSGLOGTIME|VERBOSE_TEST)/))){if(settingname=settingname.toLowerCase(),null!==configdata[indx].match(/^SCHDAYS=./))if("*"==settingvalue)for(var i2=0;i2<daysofweek.length;i2++)$("#spdmerlin_"+daysofweek[i2].toLowerCase()).prop("checked",!0);else for(var schdayarray=settingvalue.split(","),i2=0;i2<schdayarray.length;i2++)$("#spdmerlin_"+schdayarray[i2].toLowerCase()).prop("checked",!0);else null!==configdata[indx].match(/^USEPREFERRED_./)?"true"===settingvalue?eval("document.form.spdmerlin_"+settingname).checked=!0:"false"===settingvalue&&(eval("document.form.spdmerlin_"+settingname).checked=!1):null!==configdata[indx].match(/^PREFERREDSERVER_./)?$("#span_spdmerlin_"+settingname).html(configdata[indx].split("=")[0].split("_")[1]+" - "+settingvalue):-1==configdata[indx].indexOf("PREFERRED")&&(eval("document.form.spdmerlin_"+settingname).value=settingvalue);null!==configdata[indx].match(/^AUTOMATICMODE=./)?AutomaticInterfaceEnableDisable($("#spdmerlin_auto_"+document.form.spdmerlin_automaticmode.value)[0]):null!==configdata[indx].match(/^AUTOBW_./)?AutoBWEnableDisable($("#spdmerlin_autobw_"+document.form.spdmerlin_autobw_enabled.value)[0]):null!==configdata[indx].match(/^SPEEDTESTBINARY=./)&&(speedtestbinary=settingvalue)}document.getElementById("theDaysToKeepText").textContent=theDaysToKeepTXT,document.getElementById("theLastXResultsText").textContent=theLastXResultsTXT,-1!=$("[name=spdmerlin_schhours]").val().indexOf("/")&&0==$("[name=spdmerlin_schmins]").val()?(document.form.schedulemode.value="EveryX",document.form.everyxselect.value="hours",document.form.everyxvalue.value=$("[name=spdmerlin_schhours]").val().split("/")[1]):-1!=$("[name=spdmerlin_schmins]").val().indexOf("/")&&"*"==$("[name=spdmerlin_schhours]").val()?(document.form.schedulemode.value="EveryX",document.form.everyxselect.value="minutes",document.form.everyxvalue.value=$("[name=spdmerlin_schmins]").val().split("/")[1]):document.form.schedulemode.value="Custom",ScheduleModeToggle($("#schmode_"+$("[name=schedulemode]:checked").val().toLowerCase())[0])}}),get_autobw_file()}function getInterfacesFile(){$.ajax({url:"/ext/spdmerlin/interfaces_user.htm",dataType:"text",error:function(e){setTimeout(getInterfacesFile,1e3)},success:function(e){showhide("spdtest_text",!1),showhide("imgSpdTest",!1),showhide("btnRunSpeedtest",!0),showhide("databaseSize_text",!0);const t=[2,3,4,5,7,8,9,10];let a,s,r,i,n,l,o,d,c;var p=e.split("\n");if((p=p.filter(Boolean)).sort(),d=p.findIndex((e=>e.startsWith("WAN"))),d>0){const e=p.splice(d,1)[0];p.unshift(e)}interfaceList="",interfacesComplete=[],interfacesDisabled=[];var m='<div style="line-height:10px;">&nbsp;</div>';m+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable" id="table_allinterfaces">',m+='<thead class="collapsible-jquery" id="thead_allinterfaces">',m+="<tr><td>Interfaces (click to expand/collapse)</td></tr>",m+="</thead>",m+='<tr><td align="center" style="padding: 0px;">';var u='<tr id="rowautomaticspdtest"><td class="settingname">Interfaces to use for automatic speedtests</th><td class="settingvalue">',f='<tr id="rowautospdprefserver"><td class="settingname">Interfaces that use a preferred server</th><td class="settingvalue">',h='<tr id="rowautospdprefserverselect"><td class="settingname">Preferred servers for interfaces</th><td class="settingvalue">',b='<tr id="rowmanualspdtest"><td class="settingname">Interfaces to use for manual speedtest</th><td class="settingvalue">';b+='<input type="radio" name="spdtest_enabled" id="spdtest_enabled_all" onchange="Change_SpdTestInterface(this)" class="input" settingvalueradio" value="All" checked>',b+='<label for="spdtest_enabled_all">All</label>',c=0;const _=p.length;for(var v=0;v<_;v++)if(-1===p[v].indexOf("#")?(s=!1,a=p[v].trim()):(s=!0,a=p[v].substring(0,p[v].indexOf("#")).trim()),!interfacesComplete.includes(a)){if(c=interfacesComplete.length,interfacesComplete.push(a),r=a.toUpperCase(),i=a.toLowerCase(),s){o='style="margin-left:0px;"',l=r,n="Change?";var g="";-1!==p[v].indexOf("interface not up")?(interfacesDisabled.push(a),g="disabled",l='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(1,this);">'+r+"</a>",n='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(1,this);">Change?</a>'):(l='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(2,this);">'+r+"</a>",n='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(2,this);">Change?</a>'),1===c&&(u+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),u+='<input type="checkbox" name="spdmerlin_iface_enabled" id="spdmerlin_iface_enabled_'+i+'" class="input '+g+' settingvalue" value="'+r+'" '+g+" "+o+">",u+='<label for="spdmerlin_iface_enabled_'+i+'">'+l+"</label>",5===c&&(u+="</br>"),1===c&&(f+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),f+='<input type="checkbox" name="spdmerlin_usepreferred_'+i+'" id="spdmerlin_usepreferred_'+i+'" class="input '+g+' settingvalue" value="'+r+'" '+g+" "+o+">",f+='<label for="spdmerlin_usepreferred_'+i+'">'+l+"</label>",5===c&&(f+="</br>"),h+='<span style="margin-left:4px;vertical-align:top;max-width:465px;display:inline-block;" id="span_spdmerlin_preferredserver_'+i+'">'+r+":</span><br />",h+='<input type="checkbox" name="changepref_'+i+'" id="changepref_'+i+'" class="input settingvalue '+g+'" '+g+' onchange="Toggle_ChangePrefServer(this)">',h+='<label for="changepref_'+i+'">'+n+"</label>",h+='<img id="imgServerList_'+i+'" style="display:none;vertical-align:middle;" src="images/InternetScan.gif"/>',h+='<select class="disabled" name="spdmerlin_preferredserver_'+i+'" id="spdmerlin_preferredserver_'+i+'" style="min-width:100px;max-width:400px;display:none;vertical-align:top;" disabled></select><br />',1===c&&(b+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),b+='<input autocomplete="off" autocapitalize="off" type="radio" name="spdtest_enabled" id="spdtest_enabled_'+i+'" onchange="Change_SpdTestInterface(this)" class="input '+g+' settingvalueradio" value="'+r+'" '+g+" "+o+">",b+='<label for="spdtest_enabled_'+i+'">'+l+"</label>",5===c&&(b+="</br>")}else o='style="margin-left:0px;"',l='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(2,this);">'+r+"</a>",n='<a class="hintstyle" name="'+r+'" href="javascript:void(0);" onclick="SettingHint(2,this);">Change?</a>',1===c&&(u+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),u+='<input type="checkbox" name="spdmerlin_iface_enabled" id="spdmerlin_iface_enabled_'+i+'" class="input settingvalue" value="'+r+'" checked '+o+">",u+='<label for="spdmerlin_iface_enabled_'+i+'">'+l+"</label>",5===c&&(u+="</br>"),1===c&&(f+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),f+='<input type="checkbox" name="spdmerlin_usepreferred_'+i+'" id="spdmerlin_usepreferred_'+i+'" class="input settingvalue" value="'+r+'" checked '+o+">",f+='<label for="spdmerlin_usepreferred_'+i+'">'+l+"</label>",5===c&&(f+="</br>"),h+='<span style="margin-left:4px;vertical-align:top;max-width:465px;display:inline-block;" id="span_spdmerlin_preferredserver_'+i+'">'+r+":</span><br />",h+='<input type="checkbox" name="changepref_'+i+'" id="changepref_'+i+'" class="input settingvalue" onchange="Toggle_ChangePrefServer(this)">',h+='<label for="changepref_'+i+'">'+n+"</label>",h+='<img id="imgServerList_'+i+'" style="display:none;vertical-align:middle;" src="images/InternetScan.gif"/>',h+='<select class="disabled" name="spdmerlin_preferredserver_'+i+'" id="spdmerlin_preferredserver_'+i+'" style="min-width:100px;max-width:400px;display:none;vertical-align:top;" disabled></select><br />',1===c&&(b+="<br>"),t.includes(c)&&(o=null!==r.match(/^WGVPN[1-5]/)?'style="margin-left:6px !important;"':'style="margin-left:18px !important;"'),b+='<input type="radio" name="spdtest_enabled" id="spdtest_enabled_'+i+'" onchange="Change_SpdTestInterface(this)" class="input settingvalueradio" value="'+r+'" '+o+">",b+='<label for="spdtest_enabled_'+i+'">'+l+"</label>",5===c&&(b+="</br>");m+=BuildInterfaceTable(a),interfaceList+=a+","}m+="</td></tr></table>",u+="</td></tr>",f+="</td></tr>",h+="</td></tr>",b+="</td></tr>",$("#rowautomatedtests").after(h),$("#rowautomatedtests").after(f),$("#rowautomatedtests").after(u),$("#thead_manualspeedtests").after(b),GenerateManualSpdTestServerPrefSelect(),document.form.spdtest_serverpref.value="auto",","==interfaceList.charAt(interfaceList.length-1)&&(interfaceList=interfaceList.slice(0,-1)),$("#table_buttons2").after(m),maxNoCharts=3*interfaceList.split(",").length*3*2,RedrawAllCharts(),AddEventHandlers();for(var y=interfaceList.split(","),w=0;w<y.length;w++)$("#sortTable"+y[w]).empty(),$("#sortTable"+y[w]).append(BuildLastXTableNoData(y[w])),get_lastx_file(y[w]);getConfigFile()}})}function getStatsTitleFile(){$.ajax({url:"/ext/spdmerlin/spdtitletext.js",dataType:"script",error:function(e){setTimeout(getStatsTitleFile,2e3)},success:function(){SetSPDStatsTitle(),document.getElementById("databaseSize_text").textContent="Database Size: "+sqlDatabaseFileSize,null===jffsAvailableSpaceLow.match(/^WARNING[0-9]/)?(showhide("jffsFreeSpace_LOW",!1),showhide("jffsFreeSpace_NOTE",!1),showhide("jffsFreeSpace_WARN",!1),document.getElementById("jffsFreeSpace_text").textContent="JFFS Available: "+jffsAvailableSpaceStr):(document.getElementById("jffsFreeSpace_text").textContent="JFFS Available: ",document.getElementById("jffsFreeSpace_LOW").textContent=jffsAvailableSpaceStr,showhide("jffsFreeSpace_LOW",!0),"jffs"===document.form.spdmerlin_storagelocation.value?(showhide("jffsFreeSpace_NOTE",!1),showhide("jffsFreeSpace_WARN",!0)):(showhide("jffsFreeSpace_WARN",!1),showhide("jffsFreeSpace_NOTE",!0))),1===databaseResetDone&&(ClearSpdTableRows(),currentNoCharts=0,$("#Time_Format").val(GetCookie("Time_Format","number")),getInterfacesFile(),databaseResetDone+=1),setTimeout(getStatsTitleFile,4e3)}})}function get_lastx_file(e){$.ajax({url:"/ext/spdmerlin/lastx_"+e+".htm",dataType:"text",error:function(t){setTimeout(get_lastx_file,1e3,e)},success:function(t){ParseLastXData(e,t)}})}function ParseLastXData(name,data){var arraysortlines=data.split("\n");arraysortlines=arraysortlines.filter(Boolean),window["arraysortlistlines"+name]=[];for(var i=0;i<arraysortlines.length;i++)try{var resultfields=arraysortlines[i].split(","),parsedsortline=new Object;parsedsortline.Time=moment.unix(resultfields[0].trim()).format("YYYY-MM-DD HH:mm:ss"),parsedsortline.Download=resultfields[1].trim(),parsedsortline.Upload=resultfields[2].trim(),parsedsortline.Latency=resultfields[3].trim(),parsedsortline.Jitter=resultfields[4].trim(),parsedsortline.PacketLoss=resultfields[5].trim(),parsedsortline.DownloadData=resultfields[6].trim(),parsedsortline.UploadData=resultfields[7].trim(),parsedsortline.URL=resultfields[8].trim(),parsedsortline.ServerID=resultfields[9].trim(),parsedsortline.ServerName=resultfields[10].trim(),window["arraysortlistlines"+name].push(parsedsortline)}catch{}SortTable("sortTable"+name,"arraysortlistlines"+name,eval("sortname"+name)+" "+eval("sortdir"+name).replace("desc","↑").replace("asc","↓").trim(),"sortname"+name,"sortdir"+name)}function SortTable(tableid,arrayid,sorttext,sortname,sortdir){window[sortname]=sorttext.replace("↑","").replace("↓","").trim();var sorttype="number",sortfield=window[sortname];switch(window[sortname]){case"Time":sorttype="date";break;case"ResultURL":case"ServerName":sorttype="string";break}"string"==sorttype?-1==sorttext.indexOf("↓")&&-1==sorttext.indexOf("↑")||-1!=sorttext.indexOf("↓")?(eval(arrayid+" = "+arrayid+".sort((a,b) => (a."+sortfield+".toLowerCase() > b."+sortfield+".toLowerCase()) ? 1 : ((b."+sortfield+".toLowerCase() > a."+sortfield+".toLowerCase()) ? -1 : 0));"),window[sortdir]="asc"):(eval(arrayid+" = "+arrayid+".sort((a,b) => (a."+sortfield+".toLowerCase() < b."+sortfield+".toLowerCase()) ? 1 : ((b."+sortfield+".toLowerCase() < a."+sortfield+".toLowerCase()) ? -1 : 0));"),window[sortdir]="desc"):"number"==sorttype?-1==sorttext.indexOf("↓")&&-1==sorttext.indexOf("↑")||-1!=sorttext.indexOf("↓")?(eval(arrayid+" = "+arrayid+".sort((a,b) => parseFloat(a."+sortfield+'.replace("m","000")) - parseFloat(b.'+sortfield+'.replace("m","000")));'),window[sortdir]="asc"):(eval(arrayid+" = "+arrayid+".sort((a,b) => parseFloat(b."+sortfield+'.replace("m","000")) - parseFloat(a.'+sortfield+'.replace("m","000")));'),window[sortdir]="desc"):"date"==sorttype&&(-1==sorttext.indexOf("↓")&&-1==sorttext.indexOf("↑")||-1!=sorttext.indexOf("↓")?(eval(arrayid+" = "+arrayid+".sort((a, b) => new Date(a."+sortfield+") - new Date(b."+sortfield+"));"),window[sortdir]="asc"):(eval(arrayid+" = "+arrayid+".sort((a, b) => new Date(b."+sortfield+") - new Date(a."+sortfield+"));"),window[sortdir]="desc")),$("#"+tableid).empty(),$("#"+tableid).append(BuildLastXTable(tableid.replace("sortTable",""))),$("#"+tableid).find(".sortable").each((function(e,t){t.innerHTML.replace(/ \(.*\)/,"").replace(" ","")==window[sortname]&&("asc"==window[sortdir]?t.innerHTML=t.innerHTML+" ↑":t.innerHTML=t.innerHTML+" ↓")}))}function BuildLastXTableNoData(){return"<tr>",'<td class="nodata">',"Data loading...","</td>","</tr>","</table>",'<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="sortTable"><tr><td class="nodata">Data loading...</td></tr></table>'}function BuildLastXTable(e){var t='<table border="0" cellpadding="0" cellspacing="0" width="100%" class="sortTable">';t+='<col style="width:120px;">',t+='<col style="width:70px;">',t+='<col style="width:60px;">',t+='<col style="width:60px;">',t+='<col style="width:60px;">',t+='<col style="width:65px;">',t+='<col style="width:80px;">',t+='<col style="width:80px;">',t+='<col style="width:130px;">',t+='<col style="width:80px;">',t+='<col style="width:250px;">',t+='<thead class="sortTableHeader">',t+="<tr>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">Time</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">Download (Mbps)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">Upload (Mbps)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">Latency (ms)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">Jitter (ms)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,'').replace(' ',''),'sortname"+e+"','sortdir"+e+"')\">Packet Loss (%)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,'').replace(' ',''),'sortname"+e+"','sortdir"+e+"')\">Download Data (MB)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,'').replace(' ',''),'sortname"+e+"','sortdir"+e+"')\">Upload Data (MB)</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,''),'sortname"+e+"','sortdir"+e+"')\">URL</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,'').replace(' ',''),'sortname"+e+"','sortdir"+e+"')\">Server ID</th>",t+='<th class="sortable" onclick="SortTable(\'sortTable'+e+"','arraysortlistlines"+e+"',this.innerHTML.replace(/ \\(.*\\)/,'').replace(' ',''),'sortname"+e+"','sortdir"+e+"')\">Server Name</th>",t+="</tr>",t+="</thead>",t+='<tbody class="sortTableContent">';for(var a=0;a<window["arraysortlistlines"+e].length;a++)t+='<tr class="sortRow">',t+="<td>"+window["arraysortlistlines"+e][a].Time+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].Download+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].Upload+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].Latency+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].Jitter+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].PacketLoss.replace("null","N/A")+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].DownloadData+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].UploadData+"</td>",""!=window["arraysortlistlines"+e][a].URL?t+='<td><a href="'+window["arraysortlistlines"+e][a].URL+'" target="_blank">Speedtest result URL</a></td>':t+="<td>No result URL</td>",t+="<td>"+window["arraysortlistlines"+e][a].ServerID.replace("null","")+"</td>",t+="<td>"+window["arraysortlistlines"+e][a].ServerName.replace("null","")+"</td>",t+="</tr>";return t+="</tbody>",t+="</table>"}function changeAllCharts(e){value=1*e.value,name=e.id.substring(0,e.id.indexOf("_")),SetCookie(e.id,value);for(var t=interfaceList.split(","),a=0;a<t.length;a++)Draw_Chart(t[a],"Combined"),Draw_Chart(t[a],"Quality")}function changeChart(e){value=1*e.value,name=e.id.substring(0,e.id.indexOf("_")),SetCookie(e.id,value),-1!=e.id.indexOf("Combined")?Draw_Chart(name,"Combined"):-1!=e.id.indexOf("Quality")&&Draw_Chart(name,"Quality")}function SettingHint(e,t){for(var a=document.getElementsByTagName("a"),s=0;s<a.length;s++)a[s].onmouseout=nd;let r="",i=0;return 1===e?(i=t.name.replace(/\D/g,""),r=null!==t.name.match(/^WGVPN[1-5]/)?`WireGuard client ${i} interface is <b>not</b> enabled.`:null!==t.name.match(/^VPNC[1-5]/)?`OpenVPN client ${i} interface is <b>not</b> enabled.`:"Interface is <b>not</b> enabled."):2===e?(i=t.name.replace(/\D/g,""),r=null!==t.name.match(/^WGVPN[1-5]/)?`WireGuard client ${i} interface is enabled.`:null!==t.name.match(/^VPNC[1-5]/)?`OpenVPN client ${i} interface is enabled.`:"Interface is enabled."):3===e?r="Hour(s) of day to run speedtests.<br />Use an asterisk (<b>*</b>) to run every hour.<br />Valid numbers are between 0 and 23.<br />Use commas (<b>,</b>) for multiple entries.<br />Use a hyphen (<b>-</b>) to indicate a range.":4===e&&(r="Minute(s) of day to run speedtests.<br />Use an asterisk (<b>*</b>) to run every minute.<br />Valid numbers are between 0 and 59.<br />Use commas (<b>,</b>) for multiple entries.<br />Use a hyphen (<b>-</b>) to indicate a range."),overlib(r,0,0)}function BuildInterfaceTable(e){var t='<div style="line-height:10px;">&nbsp;</div>';return t+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable" id="table_interfaces_'+e+'">',t+='<thead class="collapsible-jquery" id="'+e+'">',t+="<tr>",t+='<td colspan="2">'+e+" (click to expand/collapse)</td>",t+="</tr>",t+="</thead>",t+="<tr>",t+='<td colspan="2" align="center" style="padding: 0px;">',t+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable">',t+='<thead class="collapsible-jquery" id="resulttable_'+e+'">',t+="<tr><td>Latest speedtest results (click to expand/collapse)</td></tr>",t+="</thead>",t+="<tr>",t+='<td style="padding: 0px;">',t+='<div id="sortTable'+e+'" class="sortTableContainer" style="height:300px;"></div>',t+="</td>",t+="</tr>",t+="</table>",t+='<div style="line-height:10px;">&nbsp;</div>',t+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable">',t+='<thead class="collapsible-jquery" id="table_charts">',t+="<tr>",t+="<td>Tables and Charts (click to expand/collapse)</td>",t+="</tr>",t+="</thead>",t+='<tr><td align="center" style="padding: 0px;">',t+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable">',t+='<thead class="collapsible-jquery" id="'+e+'_ChartCombined">',t+="<tr>",t+='<td colspan="2">Bandwidth (click to expand/collapse)</td>',t+="</tr>",t+="</thead>",t+='<tr class="even">',t+='<th width="40%">Data interval</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this);changePeriod(this);" id="'+e+'_Interval_Combined">',t+='<option value="0">Raw</option>',t+='<option value="1">Hours</option>',t+='<option value="2">Days</option>',t+="</select>",t+="</td>",t+="</tr>",t+='<tr class="even">',t+='<th width="40%">Period to display</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this)" id="'+e+'_Period_Combined">',t+="<option value=0>Last 24 hours</option>",t+="<option value=1>Last 7 days</option>",t+="<option value=2>Last 30 days</option>",t+="</select>",t+="</td>",t+="</tr>",t+='<tr class="even">',t+='<th width="40%">Scale type</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this)" id="'+e+'_Scale_Combined">',t+='<option value="0">Linear</option>',t+='<option value="1">Logarithmic</option>',t+="</select>",t+="</td>",t+="</tr>",t+="<tr>",t+='<td colspan="2" align="center" style="padding: 0px;">',t+='<div style="background-color:#2f3e44;border-radius:10px;width:730px;height:500px;padding-left:5px;"><canvas id="divLineChart_'+e+'_Combined" height="500" /></div>',t+="</td>",t+="</tr>",t+="</table>",t+='<div style="line-height:10px;">&nbsp;</div>',t+='<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable">',t+='<thead class="collapsible-jquery" id="'+e+'_ChartQuality">',t+="<tr>",t+='<td colspan="2">Quality (click to expand/collapse)</td>',t+="</tr>",t+="</thead>",t+='<tr class="even">',t+='<th width="40%">Data interval</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this);changePeriod(this);" id="'+e+'_Interval_Quality">',t+='<option value="0">Raw</option>',t+='<option value="1">Hours</option>',t+='<option value="2">Days</option>',t+="</select>",t+="</td>",t+="</tr>",t+='<tr class="even">',t+='<th width="40%">Period to display</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this)" id="'+e+'_Period_Quality">',t+="<option value=0>Last 24 hours</option>",t+="<option value=1>Last 7 days</option>",t+="<option value=2>Last 30 days</option>",t+="</select>",t+="</td>",t+="</tr>",t+='<tr class="even">',t+='<th width="40%">Scale type</th>',t+="<td>",t+='<select style="width:150px" class="input_option" onchange="changeChart(this)" id="'+e+'_Scale_Quality">',t+='<option value="0">Linear</option>',t+='<option value="1">Logarithmic</option>',t+="</select>",t+="</td>",t+="</tr>",t+="<tr>",t+='<td colspan="2" align="center" style="padding: 0px;">',t+='<div style="background-color:#2f3e44;border-radius:10px;width:730px;height:500px;padding-left:5px;"><canvas id="divLineChart_'+e+'_Quality" height="500" /></div>',t+="</td>",t+="</tr>",t+="</table>",t+="</td>",t+="</tr>",t+="</table>",t+="</td>",t+="</tr>",t+="</table>"}function AutomaticInterfaceEnableDisable(e){var t=e.name,a=e.value,s=t.substring(0,t.lastIndexOf("_")),r=["schhours","schmins"],i=["schedulemode","everyxselect","everyxvalue"];if("false"==a){for(var n=0;n<interfacesComplete.length;n++)$("#"+s+"_iface_enabled_"+interfacesComplete[n].toLowerCase()).prop("disabled",!0),$("#"+s+"_iface_enabled_"+interfacesComplete[n].toLowerCase()).addClass("disabled"),$("#"+s+"_usepreferred_"+interfacesComplete[n].toLowerCase()).prop("disabled",!0),$("#"+s+"_usepreferred_"+interfacesComplete[n].toLowerCase()).addClass("disabled"),$("#changepref_"+interfacesComplete[n].toLowerCase()).prop("disabled",!0),$("#changepref_"+interfacesComplete[n].toLowerCase()).addClass("disabled");for(n=0;n<r.length;n++)$("input[name="+s+"_"+r[n]+"]").addClass("disabled"),$("input[name="+s+"_"+r[n]+"]").prop("disabled",!0);for(n=0;n<daysofweek.length;n++)$("#"+s+"_"+daysofweek[n].toLowerCase()).prop("disabled",!0);for(n=0;n<i.length;n++)$("[name="+i[n]+"]").addClass("disabled"),$("[name="+i[n]+"]").prop("disabled",!0)}else if("true"==a){for(n=0;n<interfacesComplete.length;n++)0==interfacesDisabled.includes(interfacesComplete[n])&&($("#"+s+"_iface_enabled_"+interfacesComplete[n].toLowerCase()).prop("disabled",!1),$("#"+s+"_iface_enabled_"+interfacesComplete[n].toLowerCase()).removeClass("disabled"),$("#"+s+"_usepreferred_"+interfacesComplete[n].toLowerCase()).prop("disabled",!1),$("#"+s+"_usepreferred_"+interfacesComplete[n].toLowerCase()).removeClass("disabled"),$("#changepref_"+interfacesComplete[n].toLowerCase()).prop("disabled",!1),$("#changepref_"+interfacesComplete[n].toLowerCase()).removeClass("disabled"));for(n=0;n<r.length;n++)$("input[name="+s+"_"+r[n]+"]").removeClass("disabled"),$("input[name="+s+"_"+r[n]+"]").prop("disabled",!1);for(n=0;n<daysofweek.length;n++)$("#"+s+"_"+daysofweek[n].toLowerCase()).prop("disabled",!1);for(n=0;n<i.length;n++)$("[name="+i[n]+"]").removeClass("disabled"),$("[name="+i[n]+"]").prop("disabled",!1)}}function ScheduleModeToggle(e){e.name;var t=e.value;"EveryX"==t?(showhide("schfrequency",!0),showhide("schcustom",!1),"hours"==$("#everyxselect").val()?(showhide("spanxhours",!0),showhide("spanxminutes",!1)):"minutes"==$("#everyxselect").val()&&(showhide("spanxhours",!1),showhide("spanxminutes",!0))):"Custom"==t&&(showhide("schfrequency",!1),showhide("schcustom",!0))}function EveryXToggle(e){e.name;var t=e.value;"hours"==t?(showhide("spanxhours",!0),showhide("spanxminutes",!1)):"minutes"==t&&(showhide("spanxhours",!1),showhide("spanxminutes",!0)),Validate_ScheduleValue($("[name=everyxvalue]")[0])}function AutoBWEnableDisable(e){var t=e.name,a=e.value,s=t.substring(0,t.indexOf("_")),r=["autobw_ulimit","autobw_llimit","autobw_sf","autobw_threshold","autobw_average"];if("false"==a){for(var i=0;i<r.length;i++)$("input[name^="+s+"_"+r[i]+"]").addClass("disabled"),$("input[name^="+s+"_"+r[i]+"]").prop("disabled",!0);$("input[name^="+s+"_excludefromqos]").removeClass("disabled"),$("input[name^="+s+"_excludefromqos]").prop("disabled",!1)}else if("true"==a){for(i=0;i<r.length;i++)$("input[name^="+s+"_"+r[i]+"]").removeClass("disabled"),$("input[name^="+s+"_"+r[i]+"]").prop("disabled",!1);document.form.spdmerlin_excludefromqos.value=!0,$("input[name^="+s+"_excludefromqos]").addClass("disabled"),$("input[name^="+s+"_excludefromqos]").prop("disabled",!0)}}function Toggle_ChangePrefServer(e){var t=e.name,a=e.checked,s=t.split("_")[1];1==a?(document.formScriptActions.action_script.value="start_spdmerlinserverlist_"+s,document.formScriptActions.submit(),showhide("imgServerList_"+s,!0),setTimeout(get_spdtestservers_file,2e3,s)):($("#spdmerlin_preferredserver_"+s)[0].style.display="none",$("#spdmerlin_preferredserver_"+s).prop("disabled",!0),$("#spdmerlin_preferredserver_"+s).addClass("disabled"))}function Change_SpdTestInterface(e){e.name,e.value;GenerateManualSpdTestServerPrefSelect(),Toggle_SpdTestServerPref(document.form.spdtest_serverpref)}function Toggle_SpdTestServerPref(e){e.name;if("onetime"==e.value){document.formScriptActions.action_script.value="start_spdmerlinserverlistmanual_"+document.form.spdtest_enabled.value,document.formScriptActions.submit();for(var t=0;t<interfacesComplete.length;t++)$("#spdtest_enabled_"+interfacesComplete[t].toLowerCase()).prop("disabled",!0),$("#spdtest_enabled_"+interfacesComplete[t].toLowerCase()).addClass("disabled");$.each($("input[name=spdtest_serverpref]"),(function(){$(this).prop("disabled",!0),$(this).addClass("disabled")})),showhide("rowmanualserverprefselect",!0),showhide("imgManualServerList",!0),"All"==document.form.spdtest_enabled.value?$.each($("select[name^=spdtest_serverprefselect]"),(function(){$(this).empty()})):$("select[name=spdtest_serverprefselect]").empty(),setTimeout(get_manualspdtestservers_file,2e3)}else showhide("rowmanualserverprefselect",!1),"All"==document.form.spdtest_enabled.value?($.each($("select[name^=spdtest_serverprefselect]"),(function(){showhide(this.id,!1)})),$.each($("span[id^=spdtest_serverprefselectspan]"),(function(){showhide(this.id,!1)}))):showhide("spdtest_serverprefselect",!1),showhide("imgManualServerList",!1)}function GenerateManualSpdTestServerPrefSelect(){$("#rowmanualserverprefselect").remove();var e='<tr class="even" id="rowmanualserverprefselect" style="display:none;">';let t,a,s;if(e+='<td class="settingname">Choose a server</th><td class="settingvalue"><img id="imgManualServerList" style="display:none;vertical-align:middle;" src="images/InternetScan.gif"/>',"All"==document.form.spdtest_enabled.value)for(var r=0;r<interfacesComplete.length;r++)0==interfacesDisabled.includes(interfacesComplete[r])&&(t=interfacesComplete[r].toUpperCase(),a=interfacesComplete[r].toLowerCase(),s=null!==t.match(/^WGVPN[1-5]/)?'style="width:58px; display:none;"':null!==t.match(/^VPNC[1-5]/)?'style="width:46px;display:none;"':'style="width:33px; display:none;"',e+="<span "+s+' id="spdtest_serverprefselectspan_'+a+'">'+interfacesComplete[r]+':</span><select name="spdtest_serverprefselect_'+a+'" id="spdtest_serverprefselect_'+a+'" style="display:none;max-width:415px;"></select><br />');else e+='<select name="spdtest_serverprefselect" id="spdtest_serverprefselect" style="display:none;"></select>';e+="</td></tr>",$("#rowmanualserverpref").after(e)}const theDaysToKeepMIN=15,theDaysToKeepDEF=30,theDaysToKeepMAX=365,theDaysToKeepTXT=`(between ${theDaysToKeepMIN} and ${theDaysToKeepMAX}, default: ${theDaysToKeepDEF})`,theLastXResultsMIN=5,theLastXResultsDEF=10,theLastXResultsMAX=100,theLastXResultsTXT=`(between ${theLastXResultsMIN} and ${theLastXResultsMAX}, default: ${theLastXResultsDEF})`;function validateAll(){var e=!1;return Validate_Number_Setting(document.form.spdmerlin_autobw_sf_down,100,0)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_autobw_sf_up,100,0)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_autobw_threshold_down,100,0)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_autobw_threshold_up,100,0)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_autobw_average_calc,30,1)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_lastxresults,theLastXResultsMAX,theLastXResultsMIN)||(e=!0),Validate_Number_Setting(document.form.spdmerlin_daystokeep,theDaysToKeepMAX,theDaysToKeepMIN)||(e=!0),"true"===document.form.spdmerlin_automaticmode.value&&("EveryX"===document.form.schedulemode.value?Validate_ScheduleValue(document.form.everyxvalue)||(e=!0):"Custom"===document.form.schedulemode.value&&(Validate_Schedule(document.form.spdmerlin_schhours,"hours")||(e=!0),Validate_Schedule(document.form.spdmerlin_schmins,"mins")||(e=!0))),!e||(alert("**ERROR**\nValidation for some fields failed.\nPlease correct invalid values and try again."),!1)}function Validate_Schedule(e,t){e.name;var a=e.value.split(","),s=0;"hours"==t?s=23:"mins"==t&&(s=59),showhide("btnfixhours",!1),showhide("btnfixmins",!1);for(var r="false",i=0;i<a.length;i++)if("*"==a[i]&&0==i)r="false";else if("*"==a[i]&&0!=i)r="true";else if("*"==a[0]&&i>0)r="true";else if(""==a[i])r="true";else if(a[i].startsWith("*/"))(isNaN(1*a[i].replace("*/",""))||1*a[i].replace("*/","")>s||1*a[i].replace("*/","")<0)&&(r="true");else if(-1!=a[i].indexOf("-"))if(a[i].startsWith("-"))r="true";else for(var n=a[i].split("-"),l=0;l<n.length;l++)""==n[l]||isNaN(1*n[l])||1*n[l]>s||1*n[l]<0?r="true":1*n[l+1]<1*n[l]&&(r="true","hours"==t?showhide("btnfixhours",!0):"mins"==t&&showhide("btnfixmins",!0));else(isNaN(1*a[i])||1*a[i]>s||1*a[i]<0)&&(r="true");return"true"==r?($(e).addClass("invalid"),!1):($(e).removeClass("invalid"),!0)}function Validate_ScheduleValue(e){e.name;var t=1*e.value,a=0,s=$("#everyxselect").val();return"hours"==s?a=24:"minutes"==s&&(a=30),t>a||t<1||e.value.length<1?($(e).addClass("invalid"),!1):($(e).removeClass("invalid"),!0)}function Validate_Number_Setting(e,t,a){e.name;var s=1*e.value;return s>t||s<a?($(e).addClass("invalid"),!1):($(e).removeClass("invalid"),!0)}function Format_Number_Setting(e){e.name;var t=1*e.value;return 0!=e.value.length&&NaN!=t&&(e.value=parseInt(e.value),!0)}function FixCron(e){if("hours"==e){var t=document.form.spdmerlin_schhours.value;document.form.spdmerlin_schhours.value=t.split("-")[0]+"-23,0-"+t.split("-")[1],Validate_Schedule(document.form.spdmerlin_schhours,"hours")}else if("mins"==e){t=document.form.spdmerlin_schmins.value;document.form.spdmerlin_schmins.value=t.split("-")[0]+"-59,0-"+t.split("-")[1],Validate_Schedule(document.form.spdmerlin_schmins,"mins")}}function AddEventHandlers(){$(".collapsible-jquery").off("click").on("click",(function(){$(this).siblings().toggle("fast",(function(){"none"==$(this).css("display")?SetCookie($(this).siblings()[0].id,"collapsed"):SetCookie($(this).siblings()[0].id,"expanded")}))})),$(".collapsible-jquery").each((function(e,t){"collapsed"==GetCookie($(this)[0].id,"string")?$(this).siblings().toggle(!1):$(this).siblings().toggle(!0)}))}

</script>
</head>
<body onload="initial();" onunload="return unload_body();">
<div id="TopBanner"></div>
<div id="Loading" class="popup_bg"></div>
<iframe name="hidden_frame" id="hidden_frame" src="about:blank" width="0" height="0" frameborder="0"></iframe>
<form method="post" name="form" id="ruleForm" action="/start_apply.htm" target="hidden_frame">
<input type="hidden" name="action_script" value="start_spdmerlin">
<input type="hidden" name="current_page" value="">
<input type="hidden" name="next_page" value="">
<input type="hidden" name="modified" value="0">
<input type="hidden" name="action_mode" value="apply">
<input type="hidden" name="action_wait" value="90">
<input type="hidden" name="first_time" value="">
<input type="hidden" name="SystemCmd" value="">
<input type="hidden" name="preferred_lang" id="preferred_lang" value="<% nvram_get("preferred_lang"); %>">
<input type="hidden" name="firmver" value="<% nvram_get("firmver"); %>">
<input type="hidden" name="amng_custom" id="amng_custom" value="">
<table class="content" align="center" cellpadding="0" cellspacing="0">
<tr>
<td width="17">&nbsp;</td>
<td valign="top" width="202">
<div id="mainMenu"></div>
<div id="subMenu"></div></td>
<td valign="top">
<div id="tabMenu" class="submenuBlock"></div>
<table width="98%" border="0" align="left" cellpadding="0" cellspacing="0">
<tr>
<td valign="top">
<table width="760px" border="0" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTitle" id="FormTitle">
<tbody>
<tr bgcolor="#4D595D">
<td valign="top">
<div>&nbsp;</div>
<div class="formfonttitle" id="scripttitle" style="text-align:center;">spdMerlin</div>
<div id="statstitle" style="text-align:center;">Stats last updated:</div>
<div style="margin:10px 0 10px 5px;" class="splitLine"></div>
<div class="formfontdesc">spdMerlin is an internet speedtest and monitoring tool for AsusWRT Merlin with charts for daily, weekly and monthly summaries. It tracks download/upload bandwidth as well as latency, jitter and packet loss.</div>
<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;" id="table_buttons">
<thead class="collapsible-jquery" id="scripttools">
<tr><td colspan="2">Utilities (click to expand/collapse)</td></tr>
</thead>
<tr>
<td class="settingname">Version information</td>
<td>
<span id="spdmerlin_version_local" style="color:#FFFFFF;"></span>
&nbsp;&nbsp;&nbsp;
<span id="spdmerlin_version_server" style="display:none;">Update version</span>
&nbsp;&nbsp;&nbsp;
<input type="button" class="button_gen savebutton" id="btnChkUpdate" onclick="CheckUpdate();" value="Check">
<img id="imgChkUpdate" style="display:none;vertical-align:middle;" src="images/InternetScan.gif"/>
<input type="button" class="button_gen savebutton" id="btnDoUpdate" onclick="DoUpdate();" value="Update" style="display:none;">
&nbsp;&nbsp;&nbsp;
</td>
</tr>
<tr>
<td class="settingname">Export</td>
<td>
<input type="button" class="button_gen savebutton" id="btnExportCSV" name="btnExportCSV" onclick="ExportCSV();" value="Export to CSV">
</td>
</tr>
</table>
<div style="line-height:10px;">&nbsp;</div>
<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;" id="table_manualspeedtests">
<thead class="collapsible-jquery" id="thead_manualspeedtests">
<tr><td colspan="2">Manual Speedtest (click to expand/collapse)</td></tr>
</thead>
<tr class="even" id="rowmanualserverpref">
<td class="settingname">Mode for speedtest</td>
<td class="settingvalue">
<input type="radio" name="spdtest_serverpref" id="spdtest_serverpref_auto" class="input" value="auto" onchange="Toggle_SpdTestServerPref(this)" checked>
<label for="spdtest_serverpref_auto">Auto-select server</label>
<input type="radio" name="spdtest_serverpref" id="spdtest_serverpref_user" class="input" value="user" onchange="Toggle_SpdTestServerPref(this)">
<label for="spdtest_serverpref_user">Preferred server</label>
<input type="radio" name="spdtest_serverpref" id="spdtest_serverpref_onetime" class="input" value="onetime" onchange="Toggle_SpdTestServerPref(this)">
<label for="spdtest_serverpref_onetime">Choose a server</label>
</td>
</tr>
<tr class="apply_gen" valign="top" height="35px">
<td colspan="2" class="savebutton">
<input type="button" class="button_gen savebutton" name="btnRunSpeedtest" id="btnRunSpeedtest"
   onclick="RunSpeedtest();" style="margin-left:80px !important;" value="Run speedtest">
<img id="imgSpdTest" style="display:none; vertical-align:middle;" src="images/InternetScan.gif"/>
&nbsp;&nbsp;&nbsp;
<span id="spdtest_text" style="display:none;"></span>
<!--
**-------------------------------------**
** Added by Martinski W. [2025-Mar-02] **
**-------------------------------------**
-->
<span id="databaseSize_text" style="margin-left:12px; display:none; font-size: 14px; font-weight: bolder;"></span>
</td>
</tr>
<tr style="display:none;" class="spdtest_output"><td colspan="2" style="padding: 0px;">
<textarea cols="63" rows="9" wrap="off" readonly="readonly" id="spdtest_output" class="textarea_log_table" style="border:0px;font-family:Courier New,Courier,mono; font-size:11px;overflow-y:auto;overflow-x:hidden;">Speedtest output</textarea>
</td></tr>
</table>
<div style="line-height:10px;">&nbsp;</div>
<table width="100%" border="1" align="center" cellpadding="2" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;" id="table_config">
<thead class="collapsible-jquery" id="scriptconfig">
<td colspan="2">General Configuration (click to expand/collapse)</td>
</thead>
<tr class="even" valign="middle" style="border-width:0px 1px;border-style:solid;border-color:black;">
<td style="padding:0px;">
<table width="100%" border="1" align="center" cellpadding="2" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;">
<thead class="collapsible-jquery" id="testconfig">
<td colspan="2">Automatic speedtest configuration</td>
</thead>
<tr class="even" id="rowautomatedtests">
<td class="settingname">Enable automatic speedtests</td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_automaticmode" id="spdmerlin_auto_true" onchange="AutomaticInterfaceEnableDisable(this)" class="input" value="true" checked>
<label for="spdmerlin_auto_true">Yes</label>
<input type="radio" name="spdmerlin_automaticmode" id="spdmerlin_auto_false" onchange="AutomaticInterfaceEnableDisable(this)" class="input" value="false">
<label for="spdmerlin_auto_false">No</label>
</td>
</tr>
<tr class="even" id="rowschedule">
<td class="settingname">Schedule for automatic speedtests</td>
<td class="settingvalue">
<div class="schedulesettings" id="schdays">
<span class="schedulespan" style="vertical-align:top;">Day(s)</span>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_mon" class="input" value="Mon" style="margin-left:0px;"><label for="spdmerlin_mon">Mon</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_tues" class="input" value="Tues"><label for="spdmerlin_tues">Tues</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_wed" class="input" value="Wed"><label for="spdmerlin_wed">Wed</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_thurs" class="input" value="Thurs"><label for="spdmerlin_thurs">Thurs</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_fri" class="input" value="Fri"><label for="spdmerlin_fri">Fri</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_sat" class="input" value="Sat"><label for="spdmerlin_sat">Sat</label>
<input type="checkbox" name="spdmerlin_schdays" id="spdmerlin_sun" class="input" value="Sun"><label for="spdmerlin_sun">Sun</label>
</div>
<div class="schedulesettings" id="schmode">
<span class="schedulespan" style="vertical-align:top;">Mode</span>
<input type="radio" onchange="ScheduleModeToggle(this)" name="schedulemode" id="schmode_everyx" class="input" value="EveryX"><label for="schmode_everyx">Every X hours/minutes</label>
<input type="radio" onchange="ScheduleModeToggle(this)" name="schedulemode" id="schmode_custom" class="input" value="Custom" checked><label for="schmode_custom">Custom</label>
</div>
<div style="margin-bottom:0px;" class="schedulesettings" id="schfrequency">
<span class="schedulespan">Frequency</span>
<span style="color:#FFFFFF;margin-left:3px;">Every </span>
<input autocomplete="off" style="text-align:center;padding-left:2px;" type="text" maxlength="2" class="input_3_table removespacing" name="everyxvalue" id="everyxvalue" value="30" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_ScheduleValue(this)" onblur="Validate_ScheduleValue(this)" />
&nbsp;<select name="everyxselect" id="everyxselect" class="input_option" onchange="EveryXToggle(this)">
<option value="hours">hours</option><option value="minutes" selected>minutes</option></select>
<span id="spanxhours" style="color:#FFCC00;"> (between 1 and 24)</span>
<span id="spanxminutes" style="color:#FFCC00;"> (between 1 and 30, default: 30)</span>
</div>
<div id="schcustom">
<div class="schedulesettings">
<a class="hintstyle" name="HOUR" href="javascript:void(0);" onclick="SettingHint(3,this);">
<span class="schedulespan">Hours</span>
</a>
<input data-lpignore="true" autocomplete="off" autocapitalize="off" type="text" class="input_25_table" name="spdmerlin_schhours" value="*" onkeyup="Validate_Schedule(this,'hours')" onblur="Validate_Schedule(this,'hours')" />
<input id="btnfixhours" type="button" onclick="FixCron('hours');" value="Fix?" class="button_gen cronbutton" name="button" style="display:none;">
</div>
<div class="schedulesettings">
<a class="hintstyle" name="MINS" href="javascript:void(0);" onclick="SettingHint(4,this);">
<span class="schedulespan">Minutes</span>
</a>
<input data-lpignore="true" autocomplete="off" autocapitalize="off" type="text" class="input_25_table" name="spdmerlin_schmins" value="*" onkeyup="Validate_Schedule(this,'mins')" onblur="Validate_Schedule(this,'mins')" />
<input id="btnfixmins" type="button" onclick="FixCron('mins');" value="Fix?" class="button_gen cronbutton" name="button" style="display:none;">
</div>
</div>
</td>
</tr>
</table>
<div style="line-height:10px;">&nbsp;</div>
<table width="100%" border="1" align="center" cellpadding="2" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;">
<thead class="collapsible-jquery" id="autobwconfig">
<td colspan="2">AutoBW configuration</td>
</thead>
<tr class="even" id="rowautobwenabled">
<td class="settingname">Enable AutoBW?<br/><span style="color:#FFCC00;background:#2F3A3E;">Automatically adjust QoS bandwidth limits using automatic speedtest data</span></td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_autobw_enabled" id="spdmerlin_autobw_true" onchange="AutoBWEnableDisable(this)" class="input" value="true">
<label for="spdmerlin_autobw_true">Yes</label>
<input type="radio" name="spdmerlin_autobw_enabled" id="spdmerlin_autobw_false" onchange="AutoBWEnableDisable(this)" class="input" value="false" checked>
<label for="spdmerlin_autobw_false">No</label>
</td>
</tr>
<tr class="even" id="rowautobwavgcalc">
<td class="settingname">Number of speedtests to use to calculate average bandwidth</td>
<td class="settingvalue">
<input autocomplete="off" type="text" maxlength="2" class="input_3_table removespacing" name="spdmerlin_autobw_average_calc" value="10" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_Number_Setting(this,30,1)" onblur="Validate_Number_Setting(this,30,1);Format_Number_Setting(this)" /><span style="color:#FFFFFF;">&nbsp;&nbsp;speedtest(s)&nbsp;&nbsp;</span><span style="color:#FFCC00;">(between 1 and 30,default: 10)</span>
</td>
</tr>
<tr class="even" id="rowautobwsf">
<td class="settingname">Scale factor to use for speedtest results</td>
<td class="settingvalue">
<span class="schedulespan">Download</span><input autocomplete="off" type="text" maxlength="3" class="input_6_table removespacing" name="spdmerlin_autobw_sf_down" value="100" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_Number_Setting(this,100,0)" onblur="Validate_Number_Setting(this,100,0);Format_Number_Setting(this)" /><span style="color:#FFFFFF;"> %</span>
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="schedulespan">Upload</span><input autocomplete="off" type="text" maxlength="3" class="input_6_table removespacing" name="spdmerlin_autobw_sf_up" value="100" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_Number_Setting(this,100,0)" onblur="Validate_Number_Setting(this,100,0);Format_Number_Setting(this)" /><span style="color:#FFFFFF;"> %</span>
</td>
</tr>
<tr class="even" id="rowautobwlimits">
<td class="settingname">Bandwidth limits for AutoBW calculations<br/><span style="color:#FFCC00;background:#2F3A3E;">(for Upper Limit 0 = Unlimited)</span></td>
<td class="settingvalue"><span style="font-weight:bolder;color:#FFFFFF;">Upper Limit:&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span class="schedulespan">Download</span><input autocomplete="off" type="text" maxlength="4" class="input_6_table removespacing" name="spdmerlin_autobw_ulimit_down" value="100" onkeypress="return validator.isNumber(this,event)" /><span style="color:#FFFFFF;"> Mbps</span>
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="schedulespan">Upload</span><input autocomplete="off" type="text" maxlength="4" class="input_6_table removespacing" name="spdmerlin_autobw_ulimit_up" value="20" onkeypress="return validator.isNumber(this,event)" /><span style="color:#FFFFFF;"> Mbps</span><br />
<span style="font-weight:bolder;color:#FFFFFF;">Lower Limit:&nbsp;&nbsp;&nbsp;&nbsp;</span>
<span class="schedulespan">Download</span><input autocomplete="off" type="text" maxlength="4" class="input_6_table removespacing" name="spdmerlin_autobw_llimit_down" value="50" onkeypress="return validator.isNumber(this,event)" /><span style="color:#FFFFFF;"> Mbps</span>
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="schedulespan">Upload</span><input autocomplete="off" type="text" maxlength="4" class="input_6_table removespacing" name="spdmerlin_autobw_llimit_up" value="10" onkeypress="return validator.isNumber(this,event)" /><span style="color:#FFFFFF;"> Mbps</span><br />
</td>
</tr>
<tr class="even" id="rowautobwth">
<td class="settingname">Threshold for updating QoS bandwidth values</td>
<td class="settingvalue">
<span class="schedulespan">Download</span><input autocomplete="off" type="text" maxlength="3" class="input_6_table removespacing" name="spdmerlin_autobw_threshold_down" value="10" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_Number_Setting(this,100,0)" onblur="Validate_Number_Setting(this,100,0);Format_Number_Setting(this)" /><span style="color:#FFFFFF;"> %</span>
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="schedulespan">Upload</span><input autocomplete="off" type="text" maxlength="3" class="input_6_table removespacing" name="spdmerlin_autobw_threshold_up" value="10" onkeypress="return validator.isNumber(this,event)" onkeyup="Validate_Number_Setting(this,100,0)" onblur="Validate_Number_Setting(this,100,0);Format_Number_Setting(this)" /><span style="color:#FFFFFF;"> %</span>
</td>
</tr>
<tr>
<td class="settingname">AutoBW status</td>
<td class="settingvalue" style="padding:2px">
<textarea cols="75" rows="15" wrap="soft" readonly="readonly" id="AutoBWOutput" class="textarea_log_table settings" style="font-size:11px;"></textarea>
</td>
</tr>
</table>
<div style="line-height:10px;">&nbsp;</div>
<table width="100%" border="1" align="center" cellpadding="2" cellspacing="0" bordercolor="#6b8fa3" class="FormTable SettingsTable" style="border:0px;">
<thead class="collapsible-jquery" id="generalconfig">
<td colspan="2">Script configuration</td>
</thead>
<tr class="even" id="rowtimeoutput">
<td class="settingname">Time Output Mode<br/><span style="color:#FFCC00;background:#2F3A3E;">(for CSV export)</span></td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_outputtimemode" id="spdmerlin_timeoutput_non-unix" class="input" value="non-unix" checked>
<label for="spdmerlin_timeoutput_non-unix">Non-Unix</label>
<input type="radio" name="spdmerlin_outputtimemode" id="spdmerlin_timeoutput_unix" class="input" value="unix">
<label for="spdmerlin_timeoutput_unix">Unix</label>
</td>
</tr>
<tr class="even" id="rowlastxresults">
<td class="settingname">Last X results to display</td>
<td class="settingvalue">
<input autocomplete="off" type="text" maxlength="3"
   class="input_6_table removespacing" name="spdmerlin_lastxresults" value="10"
   onkeypress="return validator.isNumber(this,event)"
   onblur="Validate_Number_Setting(this,theLastXResultsMAX,theLastXResultsMIN);Format_Number_Setting(this)"
   onkeyup="Validate_Number_Setting(this,theLastXResultsMAX,theLastXResultsMIN)" data-lpignore="true"/>
&nbsp;results <span id="theLastXResultsText" style="margin-left:4px; color:#FFCC00;"></span>
</td>
</tr>
<tr class="even" id="rowdaystokeep">
<td class="settingname">Number of days of data to keep</td>
<td class="settingvalue">
<input autocomplete="off" type="text" maxlength="3"
   class="input_6_table removespacing" name="spdmerlin_daystokeep" value="30"
   onkeypress="return validator.isNumber(this,event)"
   onblur="Validate_Number_Setting(this,theDaysToKeepMAX,theDaysToKeepMIN);Format_Number_Setting(this)"
   onkeyup="Validate_Number_Setting(this,theDaysToKeepMAX,theDaysToKeepMIN)" data-lpignore="true"/>
&nbsp;days <span id="theDaysToKeepText" style="margin-left:4px; color:#FFCC00;"></span>
</td>
</tr>
<tr class="even" id="rowstorageloc">
<td class="settingname">Data Storage Location</td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_storagelocation"
   id="spdmerlin_storageloc_jffs" class="input" value="jffs" checked>
<label for="spdmerlin_storageloc_jffs">JFFS</label>
<input type="radio" name="spdmerlin_storagelocation"
   id="spdmerlin_storageloc_usb" class="input" value="usb">
<label for="spdmerlin_storageloc_usb">USB</label>
<!--
**-------------------------------------**
** Added by Martinski W. [2025-Mar-02] **
**-------------------------------------**
-->
<span id="jffsFreeSpace_text"
   style="margin-left:18px; display:none; font-size:12px; font-weight:bold;">JFFS Available</span>
<span id="jffsFreeSpace_LOW"
   style="margin-left:2px; padding-left:4px; padding-right:5px; display:none; font-size:12px; font-weight:bold; background-color:yellow; color:black;"></span>
<span id="jffsFreeSpace_WARN"
   style="margin-left:6px; padding-left:4px; padding-right:5px; display:none; font-size:12px; font-weight:bold; background-color:#C81927; color:#f2f2f2;"> <<< WARNING! </span>
<span id="jffsFreeSpace_NOTE"
   style="margin-left:6px; padding-left:4px; padding-right:5px; display:none; font-size:12px; font-weight:bold; background-color:#FF64FF; color:black;"> <<< NOTICE! </span>
</td>
</tr>
<tr class="even" id="rowspeedtestbinary">
<td class="settingname">Speedtest binary to use<br/><span style="color:#FFCC00;background:#2F3A3E;">(either built-in Ookla or speedtest-cli)</span></td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_speedtestbinary" id="spdmerlin_speedtestbinary_builtin" class="input" value="builtin" checked>
<label for="spdmerlin_speedtestbinary_builtin-unix">Built-in</label>
<input type="radio" name="spdmerlin_speedtestbinary" id="spdmerlin_speedtestbinary_external" class="input" value="external">
<label for="spdmerlin_speedtestbinary_external">External</label>
</td>
</tr>
<tr class="even" id="rowstoreresulturl">
<td class="settingname">Save speedtest URLs to database</td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_storeresulturl" id="spdmerlin_store_true" class="input" value="true">
<label for="spdmerlin_store_true">Yes</label>
<input type="radio" name="spdmerlin_storeresulturl" id="spdmerlin_store_false" class="input" value="false" checked>
<label for="spdmerlin_store_false">No</label>
</td>
</tr>
<tr class="even" id="rowexcludefromqos">
<td class="settingname">Exclude speedtests from QoS</td>
<td class="settingvalue">
<input type="radio" name="spdmerlin_excludefromqos" id="spdmerlin_exclude_true" class="input" value="true" checked>
<label for="spdmerlin_exclude_true">Yes</label>
<input type="radio" name="spdmerlin_excludefromqos" id="spdmerlin_exclude_false" class="input" value="false">
<label for="spdmerlin_exclude_false">No</label>
</td>
</tr>
</table>
</td>
</tr>
<tr class="apply_gen" valign="top" height="35px">
<td colspan="2" class="savebutton">
<input type="button" onclick="SaveConfig();" value="Save" class="button_gen savebutton" name="button">
</td>
</tr>
</table>
<div style="line-height:10px;">&nbsp;</div>
<table width="100%" border="1" align="center" cellpadding="4" cellspacing="0" bordercolor="#6b8fa3" class="FormTable" style="border:0px;" id="table_buttons2">
<thead class="collapsible-jquery" id="charttools">
<tr><td colspan="2">Chart Display Options (click to expand/collapse)</td></tr>
</thead>
<tr>
<th width="20%"><span style="color:#FFFFFF;background:#2F3A3E;">Time format</span><br /><span style="color:#FFCC00;background:#2F3A3E;">(for tooltips and Last 24h chart axis)</span></th>
<td>
<select style="width:100px" class="input_option" onchange="changeAllCharts(this)" id="Time_Format">
<option value="0">24h</option>
<option value="1">12h</option>
</select>
</td>
</tr>
<tr class="apply_gen" valign="top">
<td colspan="2" style="background-color:rgb(77,89,93);">
<input type="button" onclick="ToggleDragZoom(this);" value="Drag Zoom On" class="button_gen" name="btnDragZoom">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" onclick="ResetZoom();" value="Reset Zoom" class="button_gen" name="btnResetZoom">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" onclick="ToggleLines();" value="Toggle Lines" class="button_gen" name="btnToggleLines">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<input type="button" onclick="ToggleFill();" value="Toggle Fill" class="button_gen" name="btnToggleFill">
</td>
</tr>
</table>
<!-- Charts inserted here -->
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</td>
</tr>
</table>
</form>
<form method="post" name="formScriptActions" action="/start_apply.htm" target="hidden_frame">
<input type="hidden" name="productid" value="<% nvram_get("productid"); %>">
<input type="hidden" name="current_page" value="">
<input type="hidden" name="next_page" value="">
<input type="hidden" name="action_mode" value="apply">
<input type="hidden" name="action_script" value="">
<input type="hidden" name="action_wait" value="">
</form>
<div id="footer">
</div>
</body>
</html>
